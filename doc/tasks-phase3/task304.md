# Task 304: 外部データ読み込み（CSV）

## フェーズ

Phase 3 - UX改善・機能追加

## 依存タスク

* Task 302（`position` フィールド追加後）

## 背景

現在は `public/players.json` に固定されたデータしか使えない。ユーザーが自分のデータを使えるように、CSVファイルの読み込み機能を追加する。

## 内容

### やること

* **CSVフォーマット定義**:
  * ヘッダー行: `id,name,team,position,pa,single,double,triple,hr,bb,hbp,so`
  * 文字コード: UTF-8
  * `position` は 1文字表記（投,捕,一,二,三,遊,左,中,右,指）
* **CSV読み込みUI** (`App.svelte` または新コンポーネント `DataImport.svelte`):
  * ヘッダー内またはヘッダー下に「データ読み込み」ボタンを配置
  * クリックで `<input type="file" accept=".csv">` を発火
  * ファイル選択後に CSV をパースして `playersStore` を更新
* **CSVパーサー** (`src/lib/csvParser.ts`):
  * `parseCSV(text: string): Player[]` 関数
  * ヘッダー行のバリデーション（必須カラムの存在チェック）
  * 各行のパース: 数値フィールドの変換、空行スキップ
  * エラーハンドリング: 不正な行はスキップしてwarning表示
* **バリデーション**:
  * `pa > 0` チェック
  * `single + double + triple + hr + bb + hbp + so <= pa` チェック
  * `position` が有効な値かチェック
* **「デフォルトに戻す」ボタン**:
  * 外部データ読み込み後に元の `players.json` に戻せるようにする

## 完了条件

- [ ] CSVファイルを選択して選手データを読み込める
- [ ] 読み込み後に選手一覧が更新される
- [ ] 不正なCSVの場合にエラーメッセージが表示される
- [ ] 「デフォルトに戻す」で元のデータに戻せる
- [ ] `npm run build` が成功する

## テスト

* ユニットテスト: `parseCSV` 関数の正常系・異常系テスト
  * 正常なCSVをパース → Player[] が返る
  * ヘッダーが不正 → エラー
  * 数値が不正な行 → スキップ
  * 空ファイル → 空配列
* 手動確認: CSVファイルをアップロード → 選手一覧に反映
* 手動確認: デフォルトに戻す → 元のデータに戻る
