以下、あなたのメモを **Claude Code がそのまま実装タスク化できる「task仕様」**に落とし込みます。
（Git運用ルールに合わせて `taskNNN` 形式。NNNは後で差し替えください）

---

# doc/tasks-phase1.md（ドラフト）

**タイトル**：UI改善（打線作成のカード密度／詳細表示／遷移導線／シミュレーション画面の固定表示／探索結果表示）

## 1. 背景・目的

* 打線作成画面の選手カード密度を上げ、探索効率を改善する
* 詳細情報はオンデマンド表示に分離し、一覧は「必要十分」にする
* シミュレーション画面の可読性を改善し、打線を見ながら結果を比較できるようにする
* シミュレーション結果に「まず100試合の即時サマリ」＋「最適打順探索の結果」を追加し、意思決定の質を上げる

## 2. 対象画面

* 画面1：打線作成
* 画面2：シミュレーション

---

## 3. 仕様（画面1：打線作成）

### 3.1 左側（選手選択：一覧カードの密度改善）

**要件**

* カードサイズを縮小し、表示可能人数を増やす
* 一覧の列数を増やす（レスポンシブで可変）
* カード内の成績表示は項目を絞る
* 「詳細」ボタン押下で詳細情報を表示できる

**UI仕様（推奨）**

* 一覧は `CSS Grid` で実装

  * 例：`grid-template-columns: repeat(auto-fill, minmax(180px, 1fr))`
* カードは「コンパクト」版

  * 表示：名前、チーム、PA、HR/PA、BB+HBP/PA、SO/PA、（任意でOPS）
  * 非表示：1B/2B/3B 等の内訳は詳細へ
* 詳細表示方式（どちらでも可）

  1. モーダル（推奨：UIが分かりやすい）
  2. アコーディオン（カード内展開）

**詳細表示に含める情報（案）**

* 1B/2B/3B/HR の率と生値
* K率、BB+HBP率
* OUT率（計算値）
* 参照シーズン/期間

### 3.2 右側（打線：導線追加）

**要件**

* 「全クリア」ボタンの下に「シミュレーション開始」ボタンを追加
* 押下でシミュレーション画面へ遷移する

  * 遷移時に打線（9枠）が未完成なら、遷移せず理由表示

**挙動**

* 未設定枠がある場合：

  * ボタン押下 → エラーメッセージ表示（例：「9人全員を設定してください」）
* 設定済みの場合：

  * シミュレーション画面へ遷移（タブ切替 or ルート遷移）

---

## 4. 仕様（画面2：シミュレーション）

### 4.1 右側（打線表示の固定）

**要件**

* 画面1と同等の「右側の打線」表示を常時表示する
* スクロールしても右側は固定される（sticky）

**実装方針**

* 右側カラムを `position: sticky; top: <header高さ>` で固定
* 右側には以下を表示：

  * 現在の打線（1〜9番）
  * 「打線作成へ戻る」ボタン（画面1へ戻る）
  * （任意）「再シミュレーション」ボタン

### 4.2 左側（結果の表示構成：2段）

左側は2セクション構成にする。

#### セクションA：即時サマリ（固定100試合）

**要件**

* 画面遷移直後、入力された打線で **100試合** を実行
* 結果のサマリを最上段に表示

**表示項目（最低限）**

* 平均得点
* 中央値
* P10 / P90
* 最大/最小（任意）
* 得点分布（表形式で可：0〜n点）

**UX**

* 計算中はスピナー＋「100試合を実行中」表示
* 完了後にサマリを表示

#### セクションB：探索（ユーザ指定パラメータ）

**要件**

* ユーザが指定した探索パラメータで、

  * 打順の入れ替え（ランダム/近傍探索）を行い、
  * 評価が高い打線候補を提示する
* 評価軸は2種類：

  1. 平均得点が高い（Expected value重視）
  2. 分散が大きい（ハイリスク・ハイリターン志向）

**ユーザ入力パラメータ（案：最小）**

* 探索試行回数：例 200〜5,000
* 1候補あたりのシミュレーション試合数：例 200（重いので調整可）
* seed（任意）
* 探索方式：まずは「ランダムにシャッフルして上位採用」でOK

**出力（表示）**

* 「平均得点 上位K打線」（K=5）
* 「分散 上位K打線」（K=5）
  各候補について：
* 打順（1〜9番の名前）
* 平均得点、分散（または標準偏差）、P10/P90（任意）

**注意**

* 現在仕様では選手の重複を許容しているが、

  * 探索では「入力打線の並べ替え」なので、重複があっても自然に扱える
* 処理が重くなるため、探索は Web Worker で非同期実行（必須）

---

## 5. 実装指針（Claude Code向け）

* コンポーネント

  * `PlayerCard`：compact + details
  * `PlayerDetailsModal`（またはアコーディオン）
  * `LineupPanel`：画面1/2で共通利用
  * `SimulationSummary`：100試合サマリ
  * `LineupSearchPanel`：探索UIと結果表示
* Worker

  * 既存 `sim.worker.ts` を拡張し、2種類のジョブを扱う

    * `runFixed(N=100)`
    * `searchBest(orderings, evalTrials, evalGamesPerCandidate, metric)`
* パフォーマンス

  * 100試合はメインスレッドでも間に合う可能性があるが、統一してWorker推奨
  * 探索は必ずWorker

---

## 6. 受入条件（Definition of Done）

* 画面1の選手一覧が「コンパクト表示」になり、以前より多く表示される（列数が増える）
* カード内の成績項目が削減され、詳細ボタンで詳細が見られる
* 画面1右側に「シミュレーション開始」ボタンがあり、打線未完成なら遷移しない
* 画面2右側の打線表示がスクロールしても固定される
* 画面2左側に

  * 100試合の即時サマリ
  * 探索パラメータ入力＋平均上位/分散上位の候補表示
    が実装される
* `npm run build` が成功し、GitHub Pagesで動作する

---

## 7. テスト観点（最低限）

* 打線未完成時の遷移ブロック
* 詳細表示の開閉
* 100試合サマリが出る（seed固定で再現可能）
* 探索がUIをフリーズさせない（Worker稼働）

---

## Claude Code への依頼文（そのまま貼れる形）

以下を Claude Code に渡すテンプレです（NNNを置換）：

* 作業ブランチ：`feature/taskNNN-ui-improvements`
* worktree：`reporoot/gitworktree/taskNNN`
* 実装対象：`tasks-phase1/taskNNN.md` の全要件
* 完了条件：DoDを全て満たし `npm test`（ある場合）と `npm run build` が通ること
* 禁止事項：worktree外の編集、develop直編集

