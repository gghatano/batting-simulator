# Task 013: `rules.ts` 走者状態更新＋得点加算

## フェーズ

4. 率計算とシミュレーション（ロジック）

## 依存タスク

* Task 004

## 内容

打撃イベントに応じた走者の進塁・得点ルールを実装する。

### やること

* `src/lib/sim/rules.ts` を作成
* 走者状態の表現: `{ first: boolean, second: boolean, third: boolean }`
* `applyEvent(event, bases, outs): { bases, outs, runsScored }`
  * 各イベントの処理:
    * **BB/HBP**: 強制進塁。満塁なら3塁走者が得点
    * **1B**: 3塁走者得点、2塁走者得点、1塁→2塁、打者→1塁
    * **2B**: 3塁・2塁走者得点、1塁→3塁、打者→2塁
    * **3B**: 走者全員得点、打者→3塁
    * **HR**: 走者全員＋打者得点、走者クリア
    * **K/OUT**: アウト+1、走者変化なし
  * 戻り値: 更新後の bases, outs, この打席での得点数

## 完了条件

- [ ] 全6イベント種別が正しく処理される
- [ ] 走者状態が正しく更新される
- [ ] 得点数が正しく計算される
- [ ] 3アウト時の処理が正しい（アウトカウントのみ加算、呼び出し側で回終了を判定）

## テスト

* Vitest:
  * 無走者 + 1B → 1塁のみ占有、0得点
  * 満塁 + BB → 1得点、満塁維持
  * 満塁 + HR → 4得点、走者クリア
  * 1塁2塁 + 2B → 2得点、1塁走者3塁、打者2塁
  * 走者3塁 + 1B → 1得点、打者1塁
  * 無走者 + OUT → 0得点、アウト+1
  * 満塁 + 3B → 3得点、打者3塁
